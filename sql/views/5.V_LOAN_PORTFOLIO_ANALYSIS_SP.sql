DROP VIEW STAGING.V_LOAN_PORTFOLIO_ANALYSIS_SP;

/* Formatted on 6/26/2025 12:31:25 PM (QP5 v5.287) */
CREATE OR REPLACE FORCE VIEW STAGING.V_LOAN_PORTFOLIO_ANALYSIS_SP
(
   LOAN_ID,
   OFFICER_ID,
   LOAN_OFFICER_NAME,
   APPLICATION_AMOUNT,
   BRANCH_ID,
   BRANCH_NAME,
   PRODUCT_NAME,
   BRANCH_LOCATION,
   LOAN_AMOUNT,
   INTEREST_RATE,
   LOAN_TERM_MONTHS,
   START_DATE,
   MATURITY_DATE,
   PRINCIPAL_BALANCE,
   ACCRUED_INTEREST,
   TOTAL_INTEREST,
   MONTHS_REMAINING,
   MONTHS_ELAPSED,
   PERCENT_PAID,
   LOAN_AGE_YEARS,
   LOAN_TO_VALUE_RATIO,
   INTEREST_INCOME_TO_DATE,
   PROJECTED_INTEREST_INCOME,
   LOAN_STATUS,
   RISK_CATEGORY,
   CUSTOMER_ID,
   CUSTOMER_NAME,
   LOAN_ACCOUNT_ID,
   TOTAL_AMOUNT_DUE,
   TOTAL_PRINCIPAL_DUE,
   TOTAL_INTEREST_DUE,
   TOTAL_AMOUNT_PAID,
   PRINCIPAL_PAID,
   INTEREST_PAID,
   OUTSTANDING_AMOUNT,
   OUTSTANDING_PRINCIPAL,
   OUTSTANDING_INTEREST,
   PAST_DUE_PRINCIPAL,
   PAST_DUE_INTEREST,
   DAYS_PAST_DUE,
   TOTAL_INSTALLMENTS,
   INSTALLMENTS_PAID,
   INSTALLMENTS_PENDING,
   LAST_DUE_DATE,
   NEXT_DUE_DATE
)
   BEQUEATH DEFINER
AS
   SELECT va."LOAN_ID",
          va."OFFICER_ID",
          va."LOAN_OFFICER_NAME",
          va.APPLICATION_AMOUNT,
          va."BRANCH_ID",
          va."BRANCH_NAME",
          va."PRODUCT_NAME",
          va."BRANCH_LOCATION",
          va."LOAN_AMOUNT",
          va."INTEREST_RATE",
          va."LOAN_TERM_MONTHS",
          va."START_DATE",
          va."MATURITY_DATE",
          va."PRINCIPAL_BALANCE",
          va."ACCRUED_INTEREST",
          va."TOTAL_INTEREST",
          va."MONTHS_REMAINING",
          va."MONTHS_ELAPSED",
          va."PERCENT_PAID",
          va."LOAN_AGE_YEARS",
          va."LOAN_TO_VALUE_RATIO",
          va."INTEREST_INCOME_TO_DATE",
          va."PROJECTED_INTEREST_INCOME",
          va."LOAN_STATUS",
          va."RISK_CATEGORY",
          va."CUSTOMER_ID",
          va."CUSTOMER_NAME",
          vpa."LOAN_ACCOUNT_ID",
          vpa."TOTAL_AMOUNT_DUE",
          vpa."TOTAL_PRINCIPAL_DUE",
          vpa."TOTAL_INTEREST_DUE",
          vpa."TOTAL_AMOUNT_PAID",
          vpa."PRINCIPAL_PAID",
          vpa."INTEREST_PAID",
          vpa."OUTSTANDING_AMOUNT",
          vpa."OUTSTANDING_PRINCIPAL",
          vpa."OUTSTANDING_INTEREST",
          vpa."PAST_DUE_PRINCIPAL",
          vpa."PAST_DUE_INTEREST",
          vpa."DAYS_PAST_DUE",
          vpa."TOTAL_INSTALLMENTS",
          vpa."INSTALLMENTS_PAID",
          vpa."INSTALLMENTS_PENDING",
          vpa."LAST_DUE_DATE",
          vpa."NEXT_DUE_DATE"
     FROM V_LOAN_PORTFOLIO_ANALYSIS va, V_LOAN_REPAYMENT_AGGREGATES vpa
    WHERE vpa.LOAN_ACCOUNT_ID = VA.LOAN_ID;
